#!/bin/bash

timedatectl set-ntp true

echo -- Partitioning Drive --
parted /dev/sda -- mklabel msdos --script
parted /dev/sda -- mkpart primary 1MiB -8GiB --script
parted /dev/sda -- mkpart primary linux-swap -8GiB 100% --script

echo -- Making Filesysten --
mkfs.ext4 -L arch /dev/sda1
mkswap -L swap /dev/sda2
swapon /dev/sda2

echo -- Mounting Filesystem --
mount /dev/sda1 /mnt

echo -- Installing Kernel and Base Software --
pacstrap /mnt linux linux-firmware base base-devel vim sudo --noconfirm --needed

echo -- Generating fstab --
genfstab -U /mnt >> /mnt/etc/fstab

# We cannot chroot and continue running script so we pull down new script
# copy to the new root and then run that
curl https://raw.githubusercontent.com/CoryTibbettsDev/IUseArchBTW/master/chroot.sh > chroot.sh
cp -v chroot.sh /mnt

echo -- chroot --
arch-chroot /mnt ./mnt/chroot.sh
